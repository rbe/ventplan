#!/bin/bash
#
# /Users/rbe/project/wac2/wac
# 
# Copyright (C) 2010 Informationssysteme Ralf Bensmann.
# Alle Rechte vorbehalten. Nutzungslizenz siehe http://www.bensmann.com/license_de.html
# All Rights Reserved. Use is subject to license terms, see http://www.bensmann.com/license_en.html
# 
# Created by: rbe
#

# Operating system
OS=$(uname -s)

# Installation directory
case "${OS}" in
	Darwin)
		# Make an educated guess
		OOO_HOME=${OOO_HOME:-/Applications/OpenOffice.org.app/Contents}
		# MacOS X: Don't use program link
		# http://www.openoffice.org/issues/show_bug.cgi?id=101203
		OOO_PROGRAM=${OOO_HOME}/MacOS
	;;
	Linux)
		# Where is OpenOffice?
		OOO_HOME=
		for dir in /usr/lib /opt
		do
			[ -d ${dir}/openoffice ] && OOO_HOME=${dir}; break
			[ -d ${dir}/openoffice.org3 ] && OOO_HOME=${dir}; break
		done
		OOO_PROGRAM=${OOO_HOME}/program
		# Set JAVA_HOME
		JAVA_HOME=${OS}/jre6
		export JAVA_HOME
		PATH=${JAVA_HOME}/bin:${PATH}
		export PATH
	;;
esac

# Libraries
OOOJ="${OOO_HOME}/basis-link/ure-link/share/java"
OOOU="${OOO_HOME}/basis-link/program/classes"
OOOL="${OOO_HOME}/basis-link/program:${OOO_HOME}/basis-link/program/components:${OOO_HOME}/basis-link/ure-link/lib"

# Set UNO path
UNO_PATH="${OOO_PROGRAM}"
export UNO_PATH

# Copy juh.jar into program folder
# http://user.services.openoffice.org/en/forum/viewtopic.php?f=44&t=10825
if [ ! -f ${OOO_PROGRAM}/juh.jar ]; then
        cp ${OOOJ}/juh.jar ${OOO_PROGRAM}
fi

# Start
CLASSPATH="${OOO_PROGRAM}/juh.jar:${OOOJ}/jurt.jar:${OOOJ}/ridl.jar:${OOOU}/unoil.jar"
export CLASSPATH
java -cp "${CLASSPATH}" -Djava.library.path="${OOOL}" -d32 -jar lib/wac2.jar 2>wac2.log 1>&2

exit 0
